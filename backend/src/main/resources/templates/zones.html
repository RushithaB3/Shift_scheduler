<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Zone & Zip Code Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: #f8f9fa;
        }
        .d-flex {
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: linear-gradient(to bottom,#142871, #0c1a4e);
            color: white;
            height: 500vh;
            padding: 30px 20px;
            position: fixed;
            
        }
        .sidebar h3 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 40px;
            text-align: center;
            color: #fbfbfa;
        }
        .sidebar a {
            display: block;
            padding: 12px 16px;
            margin-bottom: 12px;
            color: #ecf0f1;
            text-decoration: none;
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.2s ease;
        }
        .sidebar a:hover,
        .sidebar a.active {
            background-color: #105396;
            color: white;
            font-weight: 600;
        }
        .main-content {
            flex-grow: 1;
            margin-left: 240px;
            padding: 30px;
        }
    </style>
</head>
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Zone & Zip Code Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: #f8f9fa;
        }
        .d-flex {
            display: flex;
        }
        .sidebar {
            width: 240px;
            background: linear-gradient(180deg, #142871, #0c1a4e);
            color: white;
            height: 100vh;
            padding: 30px 20px;
        }
        .sidebar h3 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 40px;
            text-align: center;
            color: #fbfbfa;
        }
        .sidebar a {
            display: block;
            padding: 12px 16px;
            margin-bottom: 12px;
            color: #ecf0f1;
            text-decoration: none;
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.2s ease;
        }
        .sidebar a:hover,
        .sidebar a.active {
            background-color:  #105396;
            color: white;
            font-weight: 600;
        }
        .main-content {
            flex-grow: 1;
            padding: 30px;
        }
    </style>
</head>
<body>
<div class="d-flex">
    <!-- Sidebar -->
    <div class="sidebar">
        <h3>Zentech</h3>
        <a href="/dashboard">Dashboard</a>
        <a href="/schedule_manager">Schedule Manager</a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <h2 class="mb-4 text-primary">Zone Management</h2>
        <!-- Zone Form -->
        <form th:action="@{/zones/save}" method="post" th:object="${zoneForm}" class="card p-4 shadow-sm mb-4">
            <input type="hidden" th:field="*{id}" />

            <div class="mb-3">
                <label class="form-label">Zone Name</label>
                <input type="text" th:field="*{name}" class="form-control" placeholder="e.g. Dallas or Austin" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Assign Zip Codes to This Zone</label>
                <select class="form-select" name="zipCodeIds" multiple required>
                    <option th:each="zip : ${zipCodes}" th:value="${zip.id}" th:text="${zip.code}"></option>
                </select>
                <small class="text-muted">Hold Ctrl (Windows) or Cmd (Mac) to select multiple zip codes.</small>
            </div>

            <div class="text-end">
                <button type="submit" class="btn btn-success" th:text="${zoneForm.id} != null ? 'Update Zone' : 'Add Zone'">Add Zone</button>
            </div>
        </form>


        <!-- Zone Table -->
        <div class="card shadow-sm mb-5">
            <div class="card-body">
                <h5 class="card-title">Existing Zones</h5>
                <table class="table table-bordered table-striped">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Zone Name</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="zone : ${zones}">
                            <td th:text="${zone.id}">1</td>
                            <td th:text="${zone.name}">Austin</td>
                            <td>
                                <a th:href="@{/zones/edit/{id}(id=${zone.id})}" class="btn btn-sm btn-primary">Edit</a>
                                <a th:href="@{/zones/delete/{id}(id=${zone.id})}" class="btn btn-sm btn-danger" 
                                   onclick="return confirm('Are you sure you want to delete this zone?');">Delete</a>
                            </td>
                        </tr>
                        <tr th:if="${zones.isEmpty()}">
                            <td colspan="3" class="text-center text-muted">No zones found.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script>
// Load zones into the zoneSelector dropdown
document.addEventListener("DOMContentLoaded", function () {
    fetch("/api/zones")
        .then(response => response.json())
        .then(zones => {
            const zoneDropdown = document.getElementById("zoneSelector");
            zones.forEach(zone => {
                const option = document.createElement("option");
                option.value = zone.id;
                option.textContent = zone.name;
                zoneDropdown.appendChild(option);
            });
        })
        .catch(error => console.error("Failed to load zones:", error));
});

// When a zone is selected, fetch zip codes for it
document.getElementById("zoneSelector").addEventListener("change", function () {
    const zoneId = this.value;
    const zipDropdown = document.getElementById("zipSelector");
    zipDropdown.innerHTML = '<option value="">Select Zip Code</option>';
    zipDropdown.disabled = true;

    if (zoneId) {
        fetch(`/api/zones/${zoneId}/zipcodes`)
            .then(response => response.json())
            .then(zips => {
                zips.forEach(zip => {
                    const option = document.createElement("option");
                    option.value = zip.id;
                    option.textContent = zip.code;
                    zipDropdown.appendChild(option);
                });
                zipDropdown.disabled = false;
            })
            .catch(error => console.error("Failed to load zip codes:", error));
    }
});
</script>
</body>
</html>
